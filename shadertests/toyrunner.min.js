function ShaderEffectPass(a){this.gl=a.gl||null,this.vertexShader=a.vertexShader||null,this.fragmentShader=a.fragmentShader||null,this.width=256,this.height=256,this.textures=[],this.recreate()}function RenderTargetHelper(a){
this.gl=a.gl||null,this.width=a.width||256,this.height=a.height||256,this.rttFramebuffer=null,this.rttTexture=null,this.recreate()}function TextureHelper(a){this.gl=a.gl||null,this.filename=a.filename||null,
this.rttTexture=null,this.recreate()}function ScreenTargetHelper(a){this.gl=a.gl||null,this.recreate()}function WebGLExperiment(a){this.setup=function(){},this.render=function(){}}!function(){var a=function(a){
window.console&&(window.console.error?window.console.error(a):window.console.log&&window.console.log(a))},b=function(){return window!=window.top},c=function(a){return'<table style="background-color: #8CE; width: 100%; height: 100%;"><tr><td align="center"><div style="display: table-cell; vertical-align: middle;"><div style="">'+a+"</div></div></td></tr></table>";
},d='This page requires a browser that supports WebGL.<br/><a href="http://get.webgl.org">Click here to upgrade your browser.</a>',e='It doesn\'t appear your computer can support WebGL.<br/><a href="http://get.webgl.org/troubleshooting/">Click here for more information.</a>',f=function(a,b){
function f(b){var d=a.parentNode;d&&(d.innerHTML=c(b))}if(!window.WebGLRenderingContext)return f(d),null;var h=g(a,b);return h||f(e),h},g=function(a,b){for(var c=["webgl","experimental-webgl"],d=null,e=0;e<c.length;++e){
try{d=a.getContext(c[e],b)}catch(f){}if(d)break}return d},h=function(){b()&&(document.body.className="iframe")},i=function(a,b){a.width=a.clientWidth,a.height=a.clientHeight;var c=f(a,b);return c},j=function(b,c,d,e){
var f=e||a,g=b.createShader(d);b.shaderSource(g,c),b.compileShader(g);var h=b.getShaderParameter(g,b.COMPILE_STATUS);if(!h)throw lastError=b.getShaderInfoLog(g),f("*** Error compiling shader '"+g+"':"+lastError),
b.deleteShader(g),lastError;return g},k=function(b,c,d,e,f){for(var g=f||a,h=b.createProgram(),i=0;i<c.length;++i)b.attachShader(h,c[i]);if(d)for(var i=0;i<d.length;++i)b.bindAttribLocation(h,e?e[i]:i,d[i]);
b.linkProgram(h);var j=b.getProgramParameter(h,b.LINK_STATUS);if(!j)throw lastError=b.getProgramInfoLog(h),g("Error in program linking:"+lastError),b.deleteProgram(h),lastError;return h},l=function(a,b,c,d,e,f){
var g="",h=document.getElementById(b);if(!h)throw"*** Error: unknown script element"+b;g=(e||"")+h.text+(f||"");var i;if(!c)if("x-shader/x-vertex"==h.type)i=a.VERTEX_SHADER;else if("x-shader/x-fragment"==h.type)i=a.FRAGMENT_SHADER;else if(i!=a.VERTEX_SHADER&&i!=a.FRAGMENT_SHADER)throw"*** Error: unknown shader type";
return j(a,g,c?c:i,d)},m=["VERTEX_SHADER","FRAGMENT_SHADER"],n=function(b,c,d,e){var f,g=e||a;if("x-shader/x-vertex"==d)f=b.VERTEX_SHADER;else if("x-shader/x-fragment"==d)f=b.FRAGMENT_SHADER;else if(f!=b.VERTEX_SHADER&&f!=b.FRAGMENT_SHADER)throw"*** Error: unknown shader type";
var h=b.createShader(f),i=new XMLHttpRequest;return i.onreadystatechange=function(){if(4==i.readyState&&200==i.status){var a=""+i.responseText;console.log("got text",a),b.shaderSource(h,a),b.compileShader(h);
var c=b.getShaderParameter(h,b.COMPILE_STATUS);c||(lastError=b.getShaderInfoLog(h),g("*** Error compiling shader '"+h+"':"+lastError),b.deleteShader(h)),console.log("compiled shader",h)}},i.open("GET",c,!0),
i.send(),h},o=function(a,b,c,d,e){for(var f=[],g=0;g<b.length;++g)f.push(l(a,b[g],a[m[g]],e));return k(a,f,c,d,e)},p=["","MOZ_","OP_","WEBKIT_"],q=function(a,b){for(var c=0;c<p.length;++c){var d=p[c]+b,e=a.getExtension(d);
if(e)return e}},r=function(a){(a.width!=a.clientWidth||a.height!=a.clientHeight)&&(a.width=a.clientWidth,a.height=a.clientHeight)};this.createShader=j,this.createProgram=k,this.createProgramFromScripts=o,
this.createProgramFromUrl=n,this.createShaderFromUrl=n,this.createShaderFromScriptElement=l,this.getWebGLContext=i,this.updateCSSIfInIFrame=h,this.getExtensionWithKnownPrefixes=q,this.resizeCanvasToDisplaySize=r,
this.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a,b){
return window.setTimeout(a,1e3/60)}}(),this.cancelRequestAnimFrame=function(){return window.cancelCancelRequestAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||window.clearTimeout;
}()}(),ShaderEffectPass.prototype.recreate=function(){null==this.vertexShader&&(this.vertexShader=createShader(this.gl,"precision mediump float;\nattribute vec2 position;\nvoid main() { gl_Position = vec4(position.x, position.y, 0, 1); }",this.gl.VERTEX_SHADER)),
this.program=createProgram(this.gl,[this.vertexShader,this.fragmentShader]),this.positionLocation=this.gl.getAttribLocation(this.program,"position"),this.resolutionLocation=this.gl.getUniformLocation(this.program,"resolution"),
this.timeLocation=this.gl.getUniformLocation(this.program,"time"),this.mouseLocation=this.gl.getUniformLocation(this.program,"mouse"),this.textureLocation=[this.gl.getUniformLocation(this.program,"texture"),this.gl.getUniformLocation(this.program,"texture2"),this.gl.getUniformLocation(this.program,"texture3"),this.gl.getUniformLocation(this.program,"texture4")],
this.buffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.buffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.buffer),
this.gl.enableVertexAttribArray(this.positionLocation),this.gl.vertexAttribPointer(this.positionLocation,2,this.gl.FLOAT,!1,0,0)},ShaderEffectPass.prototype.render=function(a){this.gl.useProgram(this.program),
this.gl.uniform2f(this.mouseLocation,a.mousePosition.x/a.screenWidth,a.mousePosition.y/a.screenHeight),this.gl.uniform2f(this.resolutionLocation,a.targetWidth,a.targetHeight);for(var b=0;b<this.textures.length;b++)this.gl.activeTexture(this.gl.TEXTURE0+b),
this.gl.bindTexture(this.gl.TEXTURE_2D,this.textures[b]),this.gl.uniform1i(this.textureLocation[b],b);this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.buffer),this.gl.enableVertexAttribArray(this.positionLocation),
this.gl.vertexAttribPointer(this.positionLocation,2,this.gl.FLOAT,!1,0,0),this.gl.uniform1f(this.timeLocation,a.time),this.gl.drawArrays(this.gl.TRIANGLES,0,6)},ShaderEffectPass.prototype.setInputTexture=function(a,b){
this.textures[b||0]=a},RenderTargetHelper.prototype.recreate=function(){this.rttFramebuffer=this.gl.createFramebuffer(),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.rttFramebuffer),this.rttFramebuffer.width=this.width,
this.rttFramebuffer.height=this.height,this.rttTexture=this.gl.createTexture(),this.gl.bindTexture(this.gl.TEXTURE_2D,this.rttTexture),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),
this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR_MIPMAP_NEAREST),this.gl.generateMipmap(this.gl.TEXTURE_2D),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.rttFramebuffer.width,this.rttFramebuffer.height,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,null);
var a=this.gl.createRenderbuffer();this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,a),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,this.gl.DEPTH_COMPONENT16,this.rttFramebuffer.width,this.rttFramebuffer.height),
this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,this.rttTexture,0),this.gl.framebufferRenderbuffer(this.gl.FRAMEBUFFER,this.gl.DEPTH_ATTACHMENT,this.gl.RENDERBUFFER,a),
this.gl.bindTexture(this.gl.TEXTURE_2D,null),this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,null),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null)},RenderTargetHelper.prototype.beforeRender=function(a){
a.targetWidth=this.rttFramebuffer.width,a.targetHeight=this.rttFramebuffer.height,this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.rttFramebuffer),this.gl.viewport(0,0,this.rttFramebuffer.width,this.rttFramebuffer.height),
this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT)},RenderTargetHelper.prototype.afterRender=function(a){this.gl.bindTexture(this.gl.TEXTURE_2D,this.rttTexture),this.gl.generateMipmap(this.gl.TEXTURE_2D),
this.gl.bindTexture(this.gl.TEXTURE_2D,null)},RenderTargetHelper.prototype.getTexture=function(){return this.rttTexture},RenderTargetHelper.prototype.render=function(a,b){this.beforeRender(a),b(a),this.afterRender(a);
},TextureHelper.prototype.recreate=function(){this.rttTexture=this.gl.createTexture();var a=this,b=new Image;b.onload=function(){a.gl.bindTexture(a.gl.TEXTURE_2D,a.rttTexture),a.gl.texImage2D(a.gl.TEXTURE_2D,0,a.gl.RGBA,a.gl.RGBA,a.gl.UNSIGNED_BYTE,b),
a.gl.texParameteri(a.gl.TEXTURE_2D,a.gl.TEXTURE_MAG_FILTER,a.gl.LINEAR),a.gl.texParameteri(a.gl.TEXTURE_2D,a.gl.TEXTURE_MIN_FILTER,a.gl.LINEAR_MIPMAP_NEAREST),a.gl.generateMipmap(a.gl.TEXTURE_2D),a.gl.bindTexture(a.gl.TEXTURE_2D,null);
},b.src=this.filename},TextureHelper.prototype.getTexture=function(){return this.rttTexture},ScreenTargetHelper.prototype.recreate=function(){},ScreenTargetHelper.prototype.beforeRender=function(a){a.targetWidth=a.screenWidth,
a.targetHeight=a.screenHeight,this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this.gl.viewport(0,0,a.screenWidth,a.screenHeight)},ScreenTargetHelper.prototype.afterRender=function(a){},ScreenTargetHelper.prototype.getTexture=function(){},
ScreenTargetHelper.prototype.render=function(a,b){this.beforeRender(a),b(a),this.afterRender(a)},WebGLExperiment.prototype.run=function(){var a=this,b=document.getElementById("canvas"),c=getWebGLContext(b);
if(c){var d={x:0,y:0},e=500,f=500,g=0,h=function(){e=window.innerWidth,f=window.innerHeight,console.log("resize",e,f),b.width=e,b.height=f};h(),window.addEventListener("mousemove",function(a){d.x=a.x,d.y=a.y;
}),window.addEventListener("resize",h);var i=function(){var b={mousePosition:d,time:g,screenResolution:[e,f],screenWidth:e,screenHeight:f};a.render(c,b),g+=1/60,requestAnimFrame(i)};a.setup(c),requestAnimFrame(i);
}},window.initDefaultPlayer=function(){function a(){var a=window.innerWidth,b=window.innerHeight;d.width=a,d.height=b,f.uniform3f(k,a,b,0),f.viewport(0,0,a,b)}function b(a){window.innerWidth,window.innerHeight;
f.uniform4f(m,a.offsetX,a.offsetY,1,1)}function c(){f.uniform1f(l,o),f.drawArrays(f.TRIANGLES,0,6),o+=1/60,requestAnimFrame(c)}var d=document.getElementById("canvas"),e=document.getElementById("errormessage"),f=getWebGLContext(d);
if(f){var g="precision mediump float; uniform vec3 iResolution; uniform float iGlobalTime; uniform vec4 iMouse; ",h="\nvoid main() {\n  vec4 tmp = vec4(0.0, 0.0, 0.0, 1.0);\n  mainImage(tmp, gl_FragCoord.xy);\n  gl_FragColor = tmp;\n}\n\n";
program=null;try{vertexShader=createShaderFromScriptElement(f,"2d-vertex-shader",null,null,"",""),fragmentShader=createShaderFromScriptElement(f,"2d-fragment-shader",null,null,g,h),program=createProgram(f,[vertexShader,fragmentShader]);
}catch(i){console.log("error",i),e.innerText=i,e.className="visible"}if(!program)return void console.log("Error detected.");f.useProgram(program);var j=f.getAttribLocation(program,"position"),k=f.getUniformLocation(program,"iResolution"),l=f.getUniformLocation(program,"iGlobalTime"),m=f.getUniformLocation(program,"iMouse"),n=f.createBuffer();
f.bindBuffer(f.ARRAY_BUFFER,n),f.bufferData(f.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),f.STATIC_DRAW),f.enableVertexAttribArray(j),f.vertexAttribPointer(j,2,f.FLOAT,!1,0,0);var o=0;
window.addEventListener("mousemove",b),window.addEventListener("resize",a),a(),requestAnimFrame(c)}};